<ion-header>
  <ion-navbar>
    <ion-toolbar>
      <ion-title>
        Job Details
      </ion-title>
      <ion-buttons end>
        <button ion-button round (click)="onClickGoToMessageBoardButton()" color="royal">Follow up
      </button>
      </ion-buttons>
    </ion-toolbar>
  </ion-navbar>
</ion-header>

<!--DETAILED CARD-->
<ion-content padding>
  <ion-card>
    <ion-card-header>

      <ion-item>
        <button ion-button clear large [disabled]="true">
        <ion-icon icon-left md="md-bookmark" ></ion-icon>
        Job Details From Client
        </button>
      </ion-item>
    </ion-card-header>
    <ion-card-content>

      <ion-item>
        <p item-text>Room: {{job.room}}, <br>Building: {{job.building}}, <br> Placed at: {{job.getCreationTime()}}</p>
      </ion-item>
      <ion-item>
        <p>Services</p>
        <ul>
          <li *ngFor="let service of job.serviceList">
            {{service}}
          </li>
        </ul>
      </ion-item>

      <ion-item>
        <h3>Description</h3>
        <p ion-text ion-center color="danger">{{job.description}}</p>
      </ion-item>

      <ion-slides loop>
        <ion-slide *ngFor="let image of job.photosByClient">
          <img style="height:150px; margin: auto;" [src]="image" (click)="showInFullScreen(image)" />
        </ion-slide>
      </ion-slides>
    </ion-card-content>
  </ion-card>




  <!--TRADESPERSON CARD-->
  <ion-card>
    <ion-card-header>
      <ion-item>
        <ion-icon icon-left *ngIf="job.isTradespersonAssigned()" ios="ios-checkmark-circle" md="md-checkmark-circle" color="secondary"></ion-icon>
        <ion-icon icon-left *ngIf="!job.isTradespersonAssigned()" ios="ios-close-circle" md="md-close-circle"></ion-icon>
        Tradesperson
      </ion-item>
    </ion-card-header>

    <ion-card-content>

      <!--IF HAVENT ASSIGN TRADESPERSON-->
      <div *ngIf="!job.isTradespersonAssigned() && (userRole=='superUser' || userRole=='manager')">
        <button ion-button block (click)="assignTradesperson(job)"> Assign</button>
      </div>
      <!--IF ASSIGNED-->
      <div *ngIf="job.isTradespersonAssigned()">
        <h3>Assigned</h3>
        <ion-item>
          <ul>
            <li *ngFor="let user of job.tradespersonList">
              {{user.name}}
            </li>
          </ul>
        </ion-item>
      </div>
    </ion-card-content>
  </ion-card>


 <!--Please change below code to card format-->
 
  <!--IF NO CHECKIN-->
  <div *ngIf="!job.isCheckedIn() && (userRole=='superUser' || userRole=='tradesperson')">
    <button ion-button block (click)="takeCheckinPhoto()">Check-in photo </button>
    <ion-card *ngFor="let photo of photoHelper.photos">
      <img src="data:image/jpeg;base64,{{photo.image}}" />
    </ion-card>
    <button ion-button block (click)="checkin()" [disabled]="photoHelper.photos.length <= 0">Check-in</button>
  </div>

  <!--IF CHECKEDIN-->
  <div *ngIf="job.isCheckedIn()">
    <ion-card>
      <ion-title>Check-in photo</ion-title>
      <ion-card *ngFor="let url of job.checkInPhotos">
        <img [src]="url" />
      </ion-card>
    </ion-card>

    <!--IF HAVENT COMPLETE-->
    <div *ngIf="!job.isCompleted()  && (userRole=='superUser' || userRole=='tradesperson')">
      <button ion-button block (click)="takeCompletionPhoto()">Completion photo</button>
      <ion-card *ngFor="let photo of photoHelper.photos">
        <img src="data:image/jpeg;base64,{{photo.image}}" />
      </ion-card>
      <button ion-button block (click)="confirmCompletion()" [disabled]="photoHelper.photos.length <= 0">Confirm Completion</button>
    </div>
    <!--IF COMPLETED-->
    <div *ngIf="job.isCompleted()">
      <ion-card>
        <ion-title>Completion photo</ion-title>
        <ion-card *ngFor="let url of job.completionPhotos">
          <img [src]="url" />
        </ion-card>
      </ion-card>
      <ion-title style="text-align:center" *ngIf='!job.isCompletionApproved()'><strong><font size="4">Completion has not been approved</font></strong></ion-title>
      <ion-title style="text-align:center" *ngIf='job.isCompletionApproved()'><strong><font size="4">Completion Approved</font></strong></ion-title>

      <div *ngIf="!job.isCompletionApproved() && (userRole=='superUser' || userRole=='client') ">
        <button ion-button block (click)=onClickApproveCompletion()>Approve Completion</button>
      </div>
    </div>