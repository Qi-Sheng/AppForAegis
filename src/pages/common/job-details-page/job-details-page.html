<ion-header>
  <ion-navbar>
    <ion-toolbar>

      <ion-title>
        Job Details
      </ion-title>

      <ion-buttons end>
        <button ion-button round (click)="onClickGoToMessageBoardButton()" color="royal">Follow up
      </button>
      </ion-buttons>
    </ion-toolbar>
  </ion-navbar>

</ion-header>

<ion-content padding>

  <ion-title>
    Room: {{job.room}} -- Placed at: {{job.placedOn}}
  </ion-title>
  <ion-item>
    <ul>
      <li *ngFor="let service of job.serviceList">
        {{service}}
      </li>
    </ul>
  </ion-item>
  <ion-card>

    <ion-title>Description:</ion-title>
    <ion-card-content>{{job.description}}</ion-card-content>
    <ion-row>
      <ion-col *ngFor="let image of job.photosByClient">
        <img [src]="image" (click)="showInFullScreen(image)" />
      </ion-col>
    </ion-row>
  </ion-card>

  <!--IF HAVENT ASSIGN TRADESPERSON-->
  <div *ngIf="!job.isTradespersonAssigned() && (userRole=='superUser' || userRole=='manager')">
    <button ion-button block (click)="assignTradesperson(job)"> Assign Tradesperson</button>
  </div>
  <!--IF ASSIGNED-->
  <hr>
  <div *ngIf="job.isTradespersonAssigned()">
    <ion-card>
      <ion-title>Tradesperson Assigned</ion-title>
      <ion-card-content>
        <ul>
          <li *ngFor="let user of job.tradespersonList">
            {{user.name}}
          </li>
        </ul>
      </ion-card-content>
    </ion-card>

    <!--IF NO CHECKIN-->
    <div *ngIf="!job.isCheckedIn() && (userRole=='superUser' || userRole=='tradesperson')">
      <button ion-button block (click)="takeCheckinPhoto()">Check-in photo </button>
      <ion-card *ngFor="let photo of photoHelper.photos">
        <img src="data:image/jpeg;base64,{{photo.image}}" />
      </ion-card>
      <button ion-button block (click)="checkin()" [disabled]="photoHelper.photos.length <= 0">Check-in</button>
    </div>

    <!--IF CHECKEDIN-->
    <div *ngIf="job.isCheckedIn()">
      <ion-card>
        <ion-title>Check-in photo</ion-title>
        <ion-card *ngFor="let url of job.checkInPhotos">
          <img [src]="url" />
        </ion-card>
      </ion-card>

      <!--IF HAVENT COMPLETE-->
      <div *ngIf="!job.isCompleted()  && (userRole=='superUser' || userRole=='tradesperson')">
        <button ion-button block (click)="takeCompletionPhoto()">Completion photo</button>
        <ion-card *ngFor="let photo of photoHelper.photos">
          <img src="data:image/jpeg;base64,{{photo.image}}" />
        </ion-card>
        <button ion-button block (click)="confirmCompletion()" [disabled]="photoHelper.photos.length <= 0">Confirm Completion</button>
      </div>
      <!--IF COMPLETED-->
      <div *ngIf="job.isCompleted()">
        <ion-card>
          <ion-title>Completion photo</ion-title>
          <ion-card *ngFor="let url of job.completionPhotos">
            <img [src]="url" />
          </ion-card>
        </ion-card>
        <ion-title style="text-align:center" *ngIf='!job.isCompletionApproved()'><strong><font size="4">Completion has not been approved</font></strong></ion-title>
        <ion-title style="text-align:center" *ngIf='job.isCompletionApproved()'><strong><font size="4">Completion Approved</font></strong></ion-title>

        <div *ngIf="!job.isCompletionApproved() && (userRole=='superUser' || userRole=='client') ">
          <button ion-button block (click)=onClickApproveCompletion()>Approve Completion</button>
        </div>

      </div>
    </div>
  </div>
</ion-content>